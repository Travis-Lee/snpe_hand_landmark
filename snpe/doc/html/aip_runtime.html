<!--%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  Copyright (c) 2016-2018 Qualcomm Technologies, Inc.
  All Rights Reserved.
  Confidential and Proprietary - Qualcomm Technologies, Inc.
 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-->
<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"></meta>
<meta http-equiv="X-UA-Compatible" content="IE=9"></meta>
<title>Snapdragon Neural Processing Engine SDK: AIP Runtime</title>
<link href="tabs.css" rel="stylesheet" type="text/css"></link>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="autoEnterCurrentDate.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="is.css" rel="stylesheet" type="text/css" ></link>
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Snapdragon Neural Processing Engine SDK
   <span id="projectnumber"></span></div>
   <div id="projectbrief">Reference Guide</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('aip_runtime.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">AIP Runtime </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="fig_aip_runtime"></a><p> <div style= text-align:left;><img src="images/aip_runtime.png" alt="SNPE" width="20%" height="20%" align="left" hspace="3%"><br/><b>Overview</b></div><br/> </p>
<p>The AIP (AI Processor) Runtime is a software abstraction of Q6, HVX and HTA into a single entity (AIP) for the execution of a model across all three. <br />
 A user, who loads a model into Snapdragon NPE and selects the AIP runtime as a target, will have parts of the model running on HTA, and parts on HVX, orchestrated by the Q6. <br />
 <b>Note</b>: In order to execute parts of the model on HTA, the model needs to be analyzed offline, and binaries for the relevant parts need to be embedded into the DLC. See <a class="el" href="hta_support.html">Adding HTA sections</a> for details.</p>
<p>Snapdragon NPE loads a library on the DSP which communicates with the AIP Runtime.<br />
 This DSP library contains an executor (which manages the execution of models across HTA &amp; HVX), the HTA Driver for running subnets on HTA and Hexagon NN for running subnets using HVX.<br />
</p>
<p>The executor uses a model description which also contains partitioning information - description of which parts of the model will run on HTA, and which on HVX. The partitioned parts are referred below as "subnets".<br />
</p>
<p>The DSP executor executes the subnets on respective cores and coordinates buffer exchanges and format conversions as necessary to return proper outputs to the Snapdragon runtime running on the ARM CPU (including dequantization if needed).<br />
</p>
<p> <br clear="all"> </p>
<h1><a class="anchor" id="model_execution_on_aip"></a>
Model execution on AIP Runtime</h1>
<p>Let us use an illustrative example of the following model that is embedded inside a DL Container created by one of the Snapdragon NPE snpe-<em>framework</em>-to-dlc conversion tools.</p><ul>
<li>The circles represent operations in the model</li>
<li>The Rectangles represent Layers which contain and implement these operations</li>
</ul>
<p><a class="anchor" id="fig_aip_execution_1"></a><p> <div style= text-align:left;><img src="images/aip_execution_1.png" alt="SNPE" width="40%" height="40%"><br/><br/><b></b></div><br/> </p>
<p>The top-level Snapdragon NPE runtime breaks down the execution of a model to subnets that will run on different cores based on the layer affinity.</p>
<p>One of the cases may be when the entire network is executed using the AIP runtime <b>altogether</b>, as shown below:</p>
<p><a class="anchor" id="fig_aip_execution_2"></a><p> <div style= text-align:left;><img src="images/aip_execution_2.png" alt="SNPE" width="40%" height="40%"><br/><br/><b></b></div><br/> </p>
<p>Alternatively the Snapdragon NPE runtime may create multiple partitions - a few of which are executed on the AIP Runtime and the rest to fall back to the CPU Runtime as shown below:</p>
<p><a class="anchor" id="fig_aip_execution_3"></a><p> <div style= text-align:left;><img src="images/aip_execution_3.png" alt="SNPE" width="40%" height="40%"><br/><br/><b></b></div><br/> </p>
<p>The Snapdragon NPE runtime will automatically add a CPU runtime to execute the rest of the section identified to fall back to the CPU.</p>
<p>Let's examine the AIP runtime execution more closely using the example above where the entire model is executed using AIP as a reference, for simplicity.</p>
<p>The AIP Runtime further decomposes the AIP subnet into the following:</p>
<ul>
<li>HTA subnets: parts of the subnet which were compiled by the HTA Compiler, and whose metadata generated by the HTA compiler appears in the HTA sections of the DLC.</li>
<li>HNN subnets: The rest of the subnet which can run on the DSP using Hexagon NN library, whose metadata appears in the HVX sections of the DLC.</li>
</ul>
<p>Several possible combinations can arise from partitioning within the AIP runtime. Here are some representative cases:</p>
<p><b> A. The AIP subnet can run completely on HTA </b><br />
</p>
<p><a class="anchor" id="fig_aip_execution_4"></a><p> <div style= text-align:left;><img src="images/aip_execution_4.png" alt="SNPE" width="40%" height="40%"><br/><br/><b></b></div><br/> </p>
<p>In this case, the entire AIP subnet is compatible with HTA.<br />
 When loading the DLC to Snapdragon NPE and selecting AIP runtime, the runtime identifies that there is an HTA section with a single HTA subnet that <b>equals the entire AIP subnet</b>.</p>
<p><b> B. Part of the AIP subnet can run on HTA, and the rest can run on HNN </b><br />
</p>
<p><a class="anchor" id="fig_aip_execution_5"></a><p> <div style= text-align:left;><img src="images/aip_execution_5.png" alt="SNPE" width="40%" height="40%"><br/><br/><b></b></div><br/> </p>
<p>There may be cases when the entire AIP subnet cannot be processed on HTA. In such cases the HTA compiler generates HTA sections only for a smaller subset of the layers in the network. <br />
Alternatively, users may want to manually partition a network to pick a subnet that they desire to process on the HTA by providing additional options to the snpe-dlc-quantize tool (learn about partitioning a network for HTA on <a class="el" href="hta_support.html">Adding HTA sections</a>). <br />
In both these cases this smaller HTA subnet is successfully processed by the HTA compiler and the corresponding HTA section for this range is embedded in the DLC. <br />
 When loading the DLC to Snapdragon NPE and selecting the AIP runtime, the runtime identifies that there is an HTA section with a single HTA subnet which covers only part of the AIP subnet, and that the rest can run using Hexagon NN. <br />
</p>
<p><b> C. The AIP subnet is broken into multiple partitions </b><br />
</p>
<p><a class="anchor" id="fig_aip_execution_6"></a><p> <div style= text-align:left;><img src="images/aip_execution_6.png" alt="SNPE" width="40%" height="40%"><br/><br/><b></b></div><br/> </p>
<p>As an extension to the previous case it may turn out that the offline HTA compiler can only process certain portions of the identified AIP subnet, leaving the rest of the sections to be covered by multiple HNN subnets as shown above. Alternatively users may want to manually partition a network into several HTA subnets by providing additional options to the snpe-dlc-quantize tool (learn about partitioning a network for HTA on <a class="el" href="hta_support.html">Adding HTA sections</a>). </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!--%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  Copyright (c) 2016-2018 Qualcomm Technologies, Inc.
  All Rights Reserved.
  Confidential and Proprietary - Qualcomm Technologies, Inc.
 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 -->
<!-- start footer part -->
<div id="nav-path" class="navpath" font-size:small;><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
      <p align="right">
        80-NL315-14 A <br>
        MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
        <!--If the Controlled Distribution statement is to be included, uncomment below:-->
        <!--<b>Controlled Distribution - DO NOT COPY</b>-->
        <img class="footer" width:5%; alt="QTI Logo" src="images/QTI_Logo.png" />
      </p>
    </li>
  </ul>
</div>
</body>
</html>
