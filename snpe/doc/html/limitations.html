<!--%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  Copyright (c) 2016-2018 Qualcomm Technologies, Inc.
  All Rights Reserved.
  Confidential and Proprietary - Qualcomm Technologies, Inc.
 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-->
<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"></meta>
<meta http-equiv="X-UA-Compatible" content="IE=9"></meta>
<title>Snapdragon Neural Processing Engine SDK: Limitations</title>
<link href="tabs.css" rel="stylesheet" type="text/css"></link>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="autoEnterCurrentDate.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="is.css" rel="stylesheet" type="text/css" ></link>
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Snapdragon Neural Processing Engine SDK
   <span id="projectnumber"></span></div>
   <div id="projectbrief">Reference Guide</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('limitations.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title"></div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="limitations"></a> This chapter describes limitations discovered in this release during testing. Future releases will provide fixes for discovered issues.</p>
<h1><a class="anchor" id="limitations_all"></a>
General SNPE Limitations</h1>
<ul>
<li>
SNPE currently supports 4D input data, where the first dimension is batch.  </li>
<li>
Only batch of 1 is supported for RCNN networks like Faster-RCNN. See <a class="el" href="limitations.html#limitations_layers">Layer Limitations</a> below.  </li>
</ul>
<h1><a class="anchor" id="limitations_java"></a>
General Java API Limitations</h1>
<ul>
<li>
Confine INeuralNetwork instance usage to a single thread<br />
 The current SDK INeuralNetwork class instances are meant to be accessed from a single thread. Developers must make sure that is enforced within the application or unexpected errors may occur.  </li>
</ul>
<h1><a class="anchor" id="limitations_cpu"></a>
General CPU Runtime Limitations</h1>
<ul>
<li>
Not all layers have been optimized for the CPU runtime. For example, deconvolution is dramatically slower than convolution.  </li>
</ul>
<h1><a class="anchor" id="limitations_gpu"></a>
General GPU Runtime Limitations</h1>
<ul>
<li>
In GPU_FLOAT32_16_HYBRID mode, the GPU kernels use HALF_FLOAT precision for all intermediate data handling and FULL_FLOAT precision for all of its computations. While this does not typically affect mAP for networks that are being used for classification this can overflow/underflow which can impact use of the engine for uses other than classification. If an impact is observed, try running with the CPU runtime which is always FULL_FLOAT to validate any overflow/underflow issues. </li>
<li>
In GPU_FLOAT16 mode, the GPU kernels use HALF_FLOAT precision for all intermediate data handling and all of its computations. In this mode, due to lower computation precision comparing to GPU_FLOAT32_16_HYBRID, chances of negative impact on network's accuracy (e.g. mAP score) are higher. Users are encouraged to test accuracy performance of their network using this mode to ensure it meets requirements of their use case. </li>
<li>
For absolute size restrictions, the concept of “packed” channels refers to the number of channels divided by 4, and rounded up to the nearest integer:<br />
 <b><em>packed_channels = ceil(channels / 4.0)</em></b>  </li>
<li>
Whenever a layer has a 4-dimensional (i.e. batch x width x height x channels) component, such as input, output, or weight tensor, that component will have the following size restrictions: <ul>
<li>
Number of packed channels * width &lt; MaxPerGPUSize  </li>
</ul>
</li>
<li>
For all layers that have weights/biases, restrictions are: <ul>
<li>
Filter size * filter size * 4 &lt;= MaxPerGPUSize  </li>
<li>
Number of output channels / 4 &lt;= MaxPerGPUSize  </li>
</ul>
</li>
<li>
The MaxPerGPUSize is dependent on Qualcomm Adreno&trade; GPU type and the values are given below <ul>
<li>
A330: 8192 </li>
<li>
A430, A530: 16384 </li>
</ul>
</li>
<li>
While loading any network, GPU runtime may choose to merge (squash) few layers with the previous layers in the network, depending on the compatibility of the layers. This results in missing performance information for the squashed layers.  </li>
</ul>
<h1><a class="anchor" id="limitations_dsp"></a>
General DSP Runtime Limitations</h1>
<ul>
<li>
When using non-quantized models, the first network execution after network initialization may be significantly slower than subsequent executions. To avoid this, use a DLC file that has been quantized by <a class="el" href="tools.html#tools_snpe-dlc-quantize">snpe-dlc-quantize</a>.  </li>
</ul>
<h1><a class="anchor" id="limitations_aip"></a>
General AIP Runtime Limitations</h1>
<ul>
<li>
If the input layer of a network needs to be processed by HTA the input must be a 4D tensor with shape format as NHWC where the batch dimension N must be 1 and the number of channels C cannot exceed 16.  </li>
<li>
However, one could take advantage of manually partitioning a network to bypass this limitation by having the input layer be processed on the HVX instead. See <a class="el" href="hta_support.html">Adding HTA sections</a> for details on partitioning.  </li>
<li>
AIP runtime supports batched input for models which are completely using HTA or the models which have all the layers running on HTA except Softmax which is partitioned to HVX.  </li>
</ul>
<h1><a class="anchor" id="limitations_layers"></a>
Layer Limitations</h1>
<ul>
<li>
<b>ArgMax</b><a class="anchor" id="argmax_layer_limitations"></a>  <ul>
<li>
For DSP runtime, ArgMax only outputs float; its output cannot be a quantized data type due to accuracy.  </li>
</ul>
</li>
<li>
<b>Batch normalization (+ Scaling)</b><a class="anchor" id="batch_norm_layer_limitations"></a>  <ul>
<li>
Caffe: Scaling (scale_layer) is optional. If present, it extends functionality of Batch normalization (batch_norm_layer). If not present, batch_norm_layer will still be converted as per Caffe specification.<br />
 scale_layer used anywhere else in the network but immediately after the batch_norm_layer is not supported.  </li>
<li>
1d (i.e. per-channel) batch normalization: support available <b>only</b> for caffe models. support <b>not</b> available in dsp runtime.  </li>
<li>
Starting in 1.15.0, the caffe converter distinguishes between a batch_norm_layer and an instance_norm_layer using the value of the batchnorm_param use_global_stats. If use_global_stats is set to True the converter will consume the layer as a batch_norm_layer. If use_global_stats is set to False the converter will consume the layer as an instance_norm_layer. It's important to ensure the prototxt used to convert a caffe model with a batch_norm_layer has the value of use_global_stats not defined as "False" (i.e. do not use a training prototxt for conversion of a caffe model with batch_norm_layers in them)  </li>
</ul>
</li>
<li>
<b>Color space conversion</b>  <ul>
<li>
For NV21 input image encoding type, width or height must be multiple of 2. The reason is 4 Y (2wx2h) is sharing one UV pair.  </li>
</ul>
</li>
<li>
<b>Concatenation</b>  <ul>
<li>
For GPU runtime, the number of input channels in each of the inputs can assume arbitrary values. However, if one or more of these are not a multiple of 4, performance of the layer will be diminished.  </li>
</ul>
</li>
<li>
<b>Convolution</b>  <ul>
<li>
For GPU runtime, when the number of groups is greater than 1, the number of output channels must be a multiple of 4 * the number of groups. For example, with 2 groups, the number of output channels must be a multiple of 8 (4*2=8).  </li>
</ul>
</li>
<li>
<b>Crop</b>  <ul>
<li>
For GPU runtime, the number of input channels in each of the inputs must be a multiple of 4.  </li>
<li>
Crop on the DSP is not optimized in all cases. Spatial cropping is optimized (cropping height and/or width, leaving other dimensions unchanged)  </li>
</ul>
</li>
<li>
<b>Deconvolution</b>  <ul>
<li>
For GPU and CPU runtime, the number of output channels (i.e. number of filters) can be any value (not necessarily a multiple of 4). </li>
<li>
For GPU runtime the following limitations apply: <ul>
<li>
number of packed input channels * number output channels &lt;= MaxPerGPUSize  </li>
<li>
Filter size-X * Filter size-Y &lt;= MaxPerGPUSize  </li>
<li>
Stride &lt;= filter size  </li>
</ul>
</li>
<li>
For DSP runtime, deconvolutions with stride &gt; 4 are not fully optimized. </li>
<li>
Caffe parameter limitation: dilation and rectangular filters are not supported  </li>
</ul>
</li>
<li>
<b>Depthwise Convolution</b>  <ul>
<li>
Depthwise Convolution on the DSP is not optimized for all cases. The following case is optimized: <ul>
<li>
Horizontal stride is &lt;= 2.  </li>
<li>
Filter is 3x3.  </li>
<li>
Depth is a multiple of 32.  </li>
</ul>
</li>
</ul>
</li>
<li>
<b>Detection Output</b>  <ul>
<li>
keepTopK must be provided. </li>
<li>
Output buffer must be of sufficient size. </li>
<li>
For DSP runtime, batch &gt; 1 and dlc caching is not supported.  </li>
</ul>
</li>
<li>
<b>Fully connected</b>  <ul>
<li>
For GPU runtime, the following limitations apply: <ul>
<li>
Input width * input height * number of input channels &lt;= MaxPerGPUSize  </li>
<li>
Number of output channels &lt;= MaxPerGPUSize  </li>
</ul>
</li>
<li>
For DSP Runtime, batch &gt; 1 is optimized only when input height * width * channel is a multiple of 16.  </li>
</ul>
</li>
<li>
<b>Input Image Scaling</b>  <ul>
<li>
The DSP runtime image scaling performs well under the conditions listed below. Other configurations are not optimized. <ul>
<li>
Scale factor is an upscale by 2x AND  </li>
<li>
Depth is a power of 2 AND either  <ul>
<li>
Depth is less than 128 with width equal to a power of 2 OR  </li>
<li>
Depth is greater than 128.  </li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<b>Instance Normalization</b>  <ul>
<li>
For certain models containing InstanceNorm layers, the default value for the “epsilon” parameter could overwhelm the standard deviation of the input tensor. In such cases a numerical discrepancy between the source framework and SNPE can happen. For such cases it helps to override the value of epsilon in the source model to a much smaller value. <br />
 For instance, for Caffe: <br />
<pre class="fragment">             batch_norm_param {
                 use_global_stats: false
                 eps: 1e-9
             }</pre>  </li>
</ul>
</li>
<li>
<b>Pad</b>  <ul>
<li>
For the DSP runtime, <ul>
<li>
does not support non 4D padding inputs. </li>
</ul>
<ul>
<li>
does not support padding along batch. </li>
</ul>
<ul>
<li>
does not support padding along depth for reflect padding. </li>
</ul>
</li>
</ul>
</li>
<li>
<b>Pooling</b>  <ul>
<li>
Caffe parameter limitation: Average and Maximum pooling methods are supported, but not Stochastic. <br />
  </li>
</ul>
</li>
<li>
<b>Power</b><a class="anchor" id="power_layer_limitations"></a>  <ul>
<li>
Power layer is only supported on DSP and has a Caffe parameter limitation: only shift = 0 and power = 1 are supported. <br />
  </li>
</ul>
</li>
<li>
<b>Proposal</b>  <ul>
<li>
Proposal layer is not supported on the GPU.  </li>
<li>
Only batch of 1 is supported.  </li>
</ul>
</li>
<li>
<b>ROI Pooling</b>  <ul>
<li>
ROI Pooling is not supported on the GPU.  </li>
<li>
For DSP runtime, the input to the ROI Pooling layer must be a Proposal layer or an OPAQUE Input layer.  </li>
<li>
Only batch of 1 is supported.  </li>
</ul>
</li>
<li>
<b>Scale</b>  <ul>
<li>
Scale is only supported on the DSP.  </li>
<li>
For DSP runtime, only channel scaling is supported.  </li>
</ul>
</li>
<li>
<b>Slice</b>  <ul>
<li>
Currently does not support creation of a slice layer without slice points defined.  </li>
</ul>
</li>
<li>
<b>Tile</b>  <ul>
<li>
The Tile layer will currently be displayed as a "Concatenation" layer when the topology of a network containing it is viewed using snpe-dlc-info.  </li>
</ul>
</li>
<li>
<b>UDO</b>  <ul>
<li>
<b>DSP runtime</b> <ul>
<li>
SNPE DSP requires a quantized model if the UDO has at least one quantized output.  </li>
<li>
The data types supported in DSP UDO layers are FLOAT_32 and UINT_8 (quantized with TF schema).  </li>
</ul>
</li>
<li>
<b>GPU runtime</b> <ul>
<li>
Only 16-bit floating point (OpenCL half) activations are supported in the network.  </li>
<li>
The only data type supported for activation tensors in GPU UDO layers is FLOAT_16.  </li>
</ul>
</li>
<li>
<b>CPU runtime</b> <ul>
<li>
CPU runtime always operations with full precision (FP32) tensors.  </li>
<li>
The only data type supported for activation tensors in CPU UDO layers is FLOAT_32.  </li>
</ul>
</li>
<li>
<b>Model Conversion</b> <ul>
<li>
Model conversion with UDO is not available for models trained with Caffe.  </li>
<li>
Model conversion with UDO is supported for only models trained with Caffe2 that are represented with the ONNX format.  </li>
</ul>
</li>
<li>
<b>Package Generation</b> <ul>
<li>
Multiple UDOs cannot be defined in a single config file if they are intended to be used with core type = DSP.<br />
 In this case users are required to create one config file per UDO and generate separate packages with each op. This restriction does not apply to core types CPU or GPU.  </li>
<li>
A tensor parameter in a UDO definition can be expressed with only one data type (e.g: either FLOAT_32 or FLOAT_16 but not both).<br />
 Users wanting to use their UDOs on multiple runtimes with different data types may be required to create separated config files per data type and generate multiple corresponding packages.  </li>
</ul>
</li>
<li>
<b>Application</b> <ul>
<li>
UDO integration is supported only with native C APIs. Java extensions are not available in this release.<br />
 Users who want to integrate UDOs into Android applications will have to interface with SNPE APIs at the JNI level in order to take advantage of this functionality.  </li>
</ul>
</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="limitations_tools"></a>
Tool Limitations</h1>
<ul>
<li>
<b>snpe-net-run</b> <ul>
<li>
Default profiling level is detailed.  </li>
</ul>
</li>
<li>
<b>snpe_bench.py</b> <ul>
<li>
Default profiling level is basic.  </li>
</ul>
</li>
<li>
<b>snpe-caffe2-to-dlc</b> <ul>
<li>
It is expected that initialization weights are input through the same NetDef format that the caffe translator Python script generated.  </li>
<li>
No database formats are yet supported.  </li>
</ul>
</li>
<li>
<b>snpe-dlc-info</b> <ul>
<li>
For CMRN layers, the alpha value shown is actually alpha/window_size for models converted from Caffe. <ul>
<li>
Example: snpe-dlc-info shows an alpha of 2e-05 for a CMRN layer from Caffe with a window_size of 5 and alpha of 0.0001.  </li>
</ul>
</li>
<li>
For deconvolution layers, the num filters value shown is actually num filters / group. <ul>
<li>
Example: snpe-dlc-info shows num filters as 1 for a deconvolution layer with num_output of 11 and group of 11.  </li>
</ul>
</li>
</ul>
</li>
<li>
<b>snpe-dlc-quantize</b> <ul>
<li>
The snpe-dlc-quantize tool cannot quantize models that contain UDL layers. </li>
<li>
<b>Note:</b> these models can still be run on DSP runtime. The DSP runtime will quantize the network during network initialization. </li>
</ul>
</li>
<li>
<b>snpe-tensorflow-to-dlc</b> <ul>
<li>
The TensorFlow converter does not support conversion of TensorFlow graphs that have been quantized using TensorFlow tools. In order to quantize a TensorFlow model, run the TensorFlow converter (<a class="el" href="tools.html#tools_snpe-tensorflow-to-dlc">snpe-tensorflow-to-dlc</a>) first, then run <a class="el" href="tools.html#tools_snpe-dlc-quantize">snpe-dlc-quantize</a> on the DLC file generated by the TensorFlow converter. </li>
<li>
Convolution <ul>
<li>
BiasAdd node is optional and when missing a bias of zeros will be added. </li>
</ul>
</li>
<li>
Concat <ul>
<li>
Concat node must have at least 2 non Const inputs. </li>
</ul>
</li>
<li>
ElementWise Sum/Mul/Max <ul>
<li>
Must be the only operation within it's scope. </li>
</ul>
<ul>
<li>
Does not support scalar operands. </li>
</ul>
</li>
<li>
Fully Connected <ul>
<li>
Inputs to MatMul operation must be 1D.</li>
</ul>
</li>
</ul>
</li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!--%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  Copyright (c) 2016-2018 Qualcomm Technologies, Inc.
  All Rights Reserved.
  Confidential and Proprietary - Qualcomm Technologies, Inc.
 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 -->
<!-- start footer part -->
<div id="nav-path" class="navpath" font-size:small;><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
      <p align="right">
        80-NL315-14 A <br>
        MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
        <!--If the Controlled Distribution statement is to be included, uncomment below:-->
        <!--<b>Controlled Distribution - DO NOT COPY</b>-->
        <img class="footer" width:5%; alt="QTI Logo" src="images/QTI_Logo.png" />
      </p>
    </li>
  </ul>
</div>
</body>
</html>
