<!--%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  Copyright (c) 2016-2018 Qualcomm Technologies, Inc.
  All Rights Reserved.
  Confidential and Proprietary - Qualcomm Technologies, Inc.
 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-->
<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"></meta>
<meta http-equiv="X-UA-Compatible" content="IE=9"></meta>
<title>Snapdragon Neural Processing Engine SDK: Defining a UDO</title>
<link href="tabs.css" rel="stylesheet" type="text/css"></link>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="autoEnterCurrentDate.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="is.css" rel="stylesheet" type="text/css" ></link>
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Snapdragon Neural Processing Engine SDK
   <span id="projectnumber"></span></div>
   <div id="projectbrief">Reference Guide</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('udo_operator_definition.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Defining a UDO </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>A User-Defined Operation (UDO) allows users to integrate their custom operations with SNPE to enable execution on any supported hardware accelerator. The UDO mechanism accepts a specification of a custom operation (defined below), and processes that information to process a model containing that custom operation. This section explains how such a UDO can be specified. See <a class="el" href="udo_overview.html">Overview of UDO</a> for more details about UDO and <a class="el" href="preparing_model_with_udo.html">Preparing a model with UDO</a> for details on how to convert a model that contains a UDO into a SNPE DLC for supported frameworks.</p>
<h1><a class="anchor" id="udo_config_spec"></a>
The UDO Configuration Specification</h1>
<p>As described in the <a class="el" href="udo_overview.html">Overview of UDO</a> section, a user can express the attributes of their custom operation with a configuration specification file. This UDO configuration (henceforth known as UDO config) is a description of the operation created using the Javascript Object Notation (JSON) syntax and formatting. The configuration file syntax defines fields that can be specified in key-value pairs, and arranged in a tree-like structure in accordance with JSON rules. The fields are pre-determined and will ultimately be parsed into the required information that constitutes a UDO. The information provided should be generic and independent of a particular model, meaning model-specific parameters or names need not be part of the configuration. The information will be used to identify the op within a framework model, and then ultimately serialized into the DLC model. This implies that any changes in the config would require re-generation of the DLC model to ensure the correct information is serialized.</p>
<h2><a class="anchor" id="udo_config_fields_spec"></a>
UDO Config Field Description</h2>
<p>The details of the aforementioned UDO config file can be described below.</p>
<div class="fragment"><div class="line">{</div><div class="line">    &quot;UdoPackage_0&quot;:</div><div class="line">    {</div><div class="line">        &quot;Operators&quot;: [</div><div class="line">            {</div><div class="line">                &quot;type&quot;: &quot;&quot;,</div><div class="line">                &quot;inputs&quot;:[</div><div class="line">                    {&quot;name&quot;:&quot;&quot;, &quot;data_type&quot;: &quot;FLOAT_32&quot;, &quot;static&quot;: true,</div><div class="line">                        &quot;tensor_layout&quot;: &quot;NHWC&quot;},</div><div class="line">                ],</div><div class="line">                &quot;outputs&quot;:[</div><div class="line">                    {&quot;name&quot;:&quot;&quot;,&quot;data_type&quot;: &quot;FLOAT_32&quot;}</div><div class="line">                ],</div><div class="line">                &quot;scalar_params&quot;: [</div><div class="line">                    {&quot;name&quot;:&quot;scalar_param_1&quot;, &quot;data_type&quot;: &quot;INT_32&quot;}</div><div class="line">                ],</div><div class="line">                &quot;tensor_params&quot;: [</div><div class="line">                    {&quot;name&quot;:&quot;tensor_param_1&quot;, &quot;data_type&quot;: &quot;FLOAT_32&quot;, &quot;tensor_layout&quot;: &quot;NHWC&quot;},</div><div class="line">                ],</div><div class="line">                &quot;core_types&quot;: [&quot;CPU&quot;, &quot;GPU&quot;, &quot;DSP&quot;]</div><div class="line">            }</div><div class="line">        ],</div><div class="line">        &quot;UDO_PACKAGE_NAME&quot;: &quot;MyCustomUdoPackage&quot;,</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><p>The above description is simply a generic configuration file to aid the definition of the fields that the user can fill. Required fields are provided with a specific value, while optional fields are denoted with empty strings. Note that an optional field only implies that there is either a default value if it is not provided, or that an empty string will be used. The full details of each available field is described hierarchically below:</p>
<ul>
<li>
<b>UdoPackage:</b> Every UDO package can be described as <em>"UdoPackage_i"</em> where <em>i</em> indicates the order in which the packages will be generated. The user is also free to use empty strings but the dictionary structure is necessary.<sup>1 </sup>  </li>
<li>
<b>Operators:</b> This is a child node of a particular UdoPackage indicating the number of operators present. <sup>6</sup> <ul>
<li>
<b>type:</b> defines the type of the operation. </li>
<li>
<b>inputs:</b> a list of input tensors to the operation. Each input is a dictionary object. <sup>2</sup> <ul>
<li>
<b>name:</b> An optional field that describes the name of the input tensor. Since the name of the input tensor is variable, the user is not required to provide this. </li>
<li>
<b>data_type:</b> A string field that describes the data-type of this input tensor. Only one data-type can be defined per tensor. The supported data-types are:<sup>7</sup> <ul>
<li>
FLOAT_16 </li>
<li>
FLOAT_32 </li>
<li>
FIXED_4 </li>
<li>
FIXED_8 </li>
<li>
FIXED_16 </li>
<li>
UINT_8 </li>
<li>
UINT_16 </li>
<li>
UINT_32 </li>
<li>
STRING </li>
</ul>
</li>
<li>
<b>static:</b> A boolean field that is required if the input data is static i.e data is provided in the model. This field needs to be set if the input tensor will contain data, otherwise the input will be treated dynamically, and the data will not be serialized. </li>
<li>
<b>tensor_layout:</b> A string field that describes the canonical dimension format of the input tensor. The supported values are: <sup>5</sup> <ul>
<li>
NCHW </li>
<li>
NHWC </li>
</ul>
</li>
</ul>
</li>
<li>
<b>outputs:</b> A list of output tensors to the operation.<sup>2</sup> </li>
<li>
<b>scalar_params:</b> A list of scalar-valued attributes.<sup>1</sup> <ul>
<li>
<b>name:</b> A required field that describes the name of the scalar parameter. </li>
<li>
<b>data_type:</b> A required field that describes the data-type supported by this scalar parameter. </li>
</ul>
</li>
<li>
<b>tensor_params:</b> A list of tensor-valued attributes.<sup>2</sup><sup> 3</sup> </li>
<li>
<b>core_types:</b> The intended IP cores for this particular operation. The supported core_types: <ul>
<li>
CPU </li>
<li>
GPU </li>
<li>
DSP </li>
</ul>
</li>
</ul>
</li>
<li>
<b>UDO_PACKAGE_NAME:</b> The name of the UDO Package, which can be any valid string.<sup>1 </sup>  </li>
</ul>
<h2><a class="anchor" id="creating_a_udo"></a>
Creating a UDO config</h2>
<p>The user should aim to fill out the fields described in the config above to adequately describe a UDO. In some cases, the information required in this config could be easily obtained from framework documentation about the operation. However, there may be subtle caveats, therefore the user is encouraged to ensure that inputs, outputs and params are properly categorized and described. A potential caveat is that inputs can be mis-categorized as parameters and vice versa, if the config is written only according to documentation. In this scenario, a useful tip is to visualize the model using an open source tool such as Netron (found here: <a href="https://github.com/lutzroeder/netron">https://github.com/lutzroeder/netron</a>) to assist with crafting the UDO config correctly.</p>
<p>Once an adequately descriptive config has been created, it can be used as an argument to the framework converters as described in <a class="el" href="preparing_model_with_udo.html">Preparing a model with UDO</a>.</p>
<p><b>Notes:</b> </p><ol>
<li>
More than one udo package can be defined in a single config file. Users should note that the package name specified here must match the package name used in creating the corresponding package.  </li>
<li>
Each input, output and tensor parameter is categorized as the same kind of tensor object, meaning that all the fields are shared. The names of inputs and outputs are not required since the config is a generic description of an operation. </li>
<li>
In the case of the parameters, the name field is always required. </li>
<li>
The tensor layout is a convention to indicate the arrangement of data within the tensor. Therefore a tensor layout of <b>NHWC</b> means that the data is organized in <code>(batch x height x width x channel)</code>, where channel is the fastest changing dimension. Note this is the default arrangement for SNPE, and that may have implications on a model containing a UDO if other tensor layouts are selected. Notably, if a tensor layout of <b>NCHW</b> is selected, then the data and/or tensor parameters may need to be reshaped to the SNPE default to maintain dimensional understanding. Should the user encounter this scenario, they may notice the introduction of intermediary permute layers prior to the UDO layer which will ultimately feed the tensors in question. These caveats should be visible as either converter warnings, debug messages or through outputs of the visualization tools described in <a class="el" href="tools.html">Tools</a>. For more details on tensor layouts, the user can consult the section:<a class="el" href="image_input.html">Input Image Formatting</a> of the documentation.  </li>
<li>
DSP runtime can handle multiple operations in one UDO package, however the provided skeleton code is tailored to define only one operation in one package. For CPU and GPU coretypes, there can be an arbitrary number of operators defined per UDO package. </li>
<li>
The data-type of a tensor determines both how the data contained in the tensor will be stored in the DLC, and the type of memory handed over by SNPE during runtime execution. While tensors get stored within the DLC in the exact data-type specified by the UDO definition, there may be runtime restrictions on the type of memory users can expect to receive depending on the chosen core-type. Users should visit the following section: <a class="el" href="compiling_udo_package.html">Compiling a UDO package</a> for more details.  </li>
</ol>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!--%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  Copyright (c) 2016-2018 Qualcomm Technologies, Inc.
  All Rights Reserved.
  Confidential and Proprietary - Qualcomm Technologies, Inc.
 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 -->
<!-- start footer part -->
<div id="nav-path" class="navpath" font-size:small;><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
      <p align="right">
        80-NL315-14 A <br>
        MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
        <!--If the Controlled Distribution statement is to be included, uncomment below:-->
        <!--<b>Controlled Distribution - DO NOT COPY</b>-->
        <img class="footer" width:5%; alt="QTI Logo" src="images/QTI_Logo.png" />
      </p>
    </li>
  </ul>
</div>
</body>
</html>
